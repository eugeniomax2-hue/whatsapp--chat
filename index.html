<script>
  const CTA_URL = "https://wa.me/message/WTBHPX3AUQMEO1";
  const FINAL_MSG = `‚ö†Ô∏è IMPORTANTE: O Grupo Agora √© Apenas para Quem Leva Isso a S√©rio!

Muitas pessoas pedem para entrar no grupo, mas nem todas est√£o realmente interessadas. Algumas entram apenas por curiosidade, n√£o aproveitam nada e acabam atrapalhando quem quer crescer de verdade.

Para evitar isso e garantir um ambiente s√©rio e de qualidade, o acesso agora exige um pagamento simb√≥lico de apenas 1 metical..

üí° Por qu√™?
Apenas para garantir que quem entra realmente valoriza o grupo e est√° comprometido em aproveitar as oportunidades.

üöÄ Se realmente queres fazer parte, clique no bot√£o abaixo e ir√°s receber as formas de pagamento.

Depois de confirmares o pagamento, ser√°s adicionado imediatamente.

Agora a escolha √© tua: ficas de fora ou entras para um ambiente onde as oportunidades s√£o reais?.`;

  const chat   = document.getElementById('chat');
  const input  = document.getElementById('input');
  const sendBtn= document.getElementById('send');

  function now(){ return new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }
  function esc(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

  // ---- mensagens do utilizador (mant√©m igual) ----
  function addUserMsg(text){
    const d=document.createElement('div'); d.className='msg me';
    const b=document.createElement('div'); b.className='bubble';
    b.innerHTML=esc(text)+` <span class='time'>${now()}</span>`;
    d.appendChild(b); chat.appendChild(d);
    // para mensagens do utilizador, pode rolar at√© ao fim
    chat.scrollTop = chat.scrollHeight;
  }

  // ---- efeito digitando: escreve a mensagem letra por letra ----
  async function typeMessageWithCTA(text, url, speed=18){
    // cria bolha vazia (bot) no topo vis√≠vel
    const wrap = document.createElement('div'); wrap.className='msg bot';
    const bubble = document.createElement('div'); bubble.className='bubble';
    const time = document.createElement('span'); time.className='time'; time.textContent = now();

    // conte√∫do ‚Äúescrevendo‚Äù
    const content = document.createElement('span');
    content.style.whiteSpace = 'pre-wrap';
    bubble.appendChild(content);
    bubble.appendChild(document.createTextNode(' '));
    bubble.appendChild(time);
    wrap.appendChild(bubble);
    chat.appendChild(wrap);

    // GARANTE que a leitura comece no topo da mensagem
    chat.scrollTop = 0;

    // mostra status "escrevendo..." no topo (se existir o elemento)
    const st = document.getElementById('status');
    const old = st ? st.textContent : '';
    if (st) st.textContent = 'escrevendo...';

    // digita letra a letra
    const chars = [...text]; // preserva emojis/acentos
    for (let i=0; i<chars.length; i++){
      content.textContent += chars[i];
      // N√ÉO rolar para o fim, para manter o in√≠cio vis√≠vel
      await new Promise(r=>setTimeout(r, speed));
    }

    // ao terminar, adiciona o bot√£o CTA
    const a = document.createElement('a');
    a.href = url; a.target = '_blank'; a.rel='noopener';
    a.className = 'cta';
    a.textContent = 'üëâ Clique aqui para pagar';
    a.style.display = 'inline-block';
    a.style.marginTop = '12px';
    a.addEventListener('click', () => {
      try { fbq('track', 'Purchase', {value: 1.00, currency: 'MZN', content_name: 'acesso_grupo_1mt'}); } catch(e) {}
    });
    bubble.insertBefore(document.createElement('br'), time);
    bubble.insertBefore(a, time);

    // volta status para "online agora"
    if (st) st.textContent = 'online agora';
  }

  window.addEventListener('DOMContentLoaded', () => {
    // come√ßa escrevendo do TOPO com efeito de digita√ß√£o
    typeMessageWithCTA(FINAL_MSG, CTA_URL, 18); // ajusta a velocidade (ms/letra)
  });

  // entrada do utilizador (visual)
  sendBtn.addEventListener('click', () => {
    const v = input.value.trim(); if(!v) return;
    input.value = ''; addUserMsg(v);
  });
  input.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); sendBtn.click(); } });
</script>
